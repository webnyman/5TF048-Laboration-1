@{
    ViewData["Title"] = "AI-analys";
    var achievedFI = ViewBag.AchievedFI as List<MlFeatureImportance>;
    var deltaFI = ViewBag.DeltaFI as List<MlFeatureImportance>;
}

<h2>AI-analys (ML.NET)</h2>

<div class="mb-3">
    <a asp-action="Index" asp-route-retrain="true" class="btn btn-sm btn-outline-secondary">🔁 Träna om modeller</a>
</div>

@if (ViewBag.Message != null)
{
    <div class="alert alert-warning">@ViewBag.Message</div>
}
else
{
    <div class="row g-3">
        <div class="col-md-6">
            <div class="card p-3 h-100">
                <h5>Klassificering: Måluppfyllnad</h5>
                <p>Accuracy: @(((double)ViewBag.AchievedAccuracy).ToString("0.000"))</p>
                <p>AUC: @(((double)ViewBag.AchievedAuc).ToString("0.000"))</p>
                <h6 class="mt-3">Viktigaste features (PFI – försämring AUC)</h6>
                <ol class="mb-3">
                    @foreach (var fi in achievedFI!.Take(8))
                    {
                        <li>@fi.Feature — ΔAUC=@(fi.DeltaAuc?.ToString("0.000") ?? "-")</li>
                    }
                </ol>
                <p><strong>What-if:</strong> 45 min, intensitet 4 → P(goal)=@(((double)ViewBag.SampleProb).ToString("0.00"))</p>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card p-3 h-100">
                <h5>Regression: Tempoökning</h5>
                <p>R²: @(((double)ViewBag.DeltaRSquared).ToString("0.000"))</p>
                <p>MAE: @(((double)ViewBag.DeltaMae).ToString("0.00"))</p>
                <h6 class="mt-3">Viktigaste features (PFI – ökad MAE)</h6>
                <ol class="mb-3">
                    @foreach (var fi in deltaFI!.Take(8))
                    {
                        <li>@fi.Feature — ΔMAE=@(fi.DeltaMAE?.ToString("0.000") ?? "-")</li>
                    }
                </ol>
                <p><strong>What-if:</strong> samma scenario → ΔTempo≈@(((double)ViewBag.SampleDelta).ToString("0.0")) bpm</p>
            </div>
        </div>
    </div>
}
